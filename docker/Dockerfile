FROM docker.tele2.kz/ext-images/openjdk21:latest

LABEL maintainer = "SoftwareDevelopment_KZ@TELE2.kz"
LABEL name = "bts-radio-data-service"
LABEL description = "BTS Radio data service"

ARG RANSHARING_DB_URL
ARG RANSHARING_DB_USERNAME
ARG RANSHARING_DB_PASSWORD
ARG ALARMS_DB_URL
ARG ALARMS_DB_USERNAME
ARG ALARMS_DB_PASSWORD
ARG MARIA_DB_URL
ARG MARIA_DB_USERNAME
ARG MARIA_DB_PASSWORD
ARG ATOLL_DB_URL
ARG ATOLL_TRANSPORT_DB_URL_ENCRYPT
ARG ATOLL_DB_USERNAME
ARG ATOLL_DB_PASSWORD
ARG CIPTRACKER_DB_URL
ARG CIPTRACKER_DB_USERNAME
ARG CIPTRACKER_DB_PASSWORD

ENV RANSHARING_DB_URL=${RANSHARING_DB_URL}
ENV RANSHARING_DB_USERNAME=${RANSHARING_DB_USERNAME}
ENV RANSHARING_DB_PASSWORD=${RANSHARING_DB_PASSWORD}
ENV ALARMS_DB_URL=${ALARMS_DB_URL}
ENV ALARMS_DB_USERNAME=${ALARMS_DB_USERNAME}
ENV ALARMS_DB_PASSWORD=${ALARMS_DB_PASSWORD}
ENV MARIA_DB_URL=${MARIA_DB_URL}
ENV MARIA_DB_USERNAME=${MARIA_DB_USERNAME}
ENV MARIA_DB_PASSWORD=${MARIA_DB_PASSWORD}
ENV ATOLL_DB_URL=${ATOLL_DB_URL}
ENV ATOLL_TRANSPORT_DB_URL_ENCRYPT=${ATOLL_TRANSPORT_DB_URL_ENCRYPT}
ENV ATOLL_DB_USERNAME=${ATOLL_DB_USERNAME}
ENV ATOLL_DB_PASSWORD=${ATOLL_DB_PASSWORD}
ENV CIPTRACKER_DB_URL=${CIPTRACKER_DB_URL}
ENV CIPTRACKER_DB_USERNAME=${CIPTRACKER_DB_USERNAME}
ENV CIPTRACKER_DB_PASSWORD=${CIPTRACKER_DB_PASSWORD}

ADD ./target/*.jar /app.jar

EXPOSE 8080

CMD ["java", \
    "-Xms128m", \
    "-Xmx1024m", \
    "-XX:MetaspaceSize=128M", \
    "-XX:MaxMetaspaceSize=256m", \
    "-XX:+UnlockExperimentalVMOptions", \
    "-XX:+UseShenandoahGC", \
    "-XX:ParallelGCThreads=4", \
    "-Djava.net.preferIPv4Stack=true", \
    "-Djava.awt.headless=true", \
    "-Dsun.rmi.dgc.client.gcInterval=1800000", \
    "-Dsun.rmi.dgc.server.gcInterval=1800000", \
    "-jar", \
    "/app.jar"]